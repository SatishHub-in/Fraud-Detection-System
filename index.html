<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraud Detection System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        const App = () => {
            const [transactions, setTransactions] = useState([]);
            const [metrics, setMetrics] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [message, setMessage] = useState('');
            const [showMessageBox, setShowMessageBox] = useState(false);
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            const NUM_TRANSACTIONS = 1000;
            const FRAUD_RATE = 0.02;
            const ANOMALY_THRESHOLD = 0.6;

            const showMessage = (msg) => {
                setMessage(msg);
                setShowMessageBox(true);
            };

            const closeMessageBox = () => {
                setShowMessageBox(false);
                setMessage('');
            };

            const simulateIsolationForest = (transaction) => {
                let score = 0;
                if (transaction.amount > 5000) score += 0.3;
                if (transaction.amount < 10) score += 0.1;

                if (transaction.time < 100) score += 0.2;

                if (Math.abs(transaction.V1) > 3 || Math.abs(transaction.V2) > 3) score += 0.15;
                if (Math.abs(transaction.V10) > 2 || Math.abs(transaction.V12) > 2) score += 0.15;

                score += Math.random() * 0.2;

                return Math.min(1, score);
            };

            const simulateAutoencoder = (transaction) => {
                let error = 0;
                if (transaction.isFraud) {
                    error = 0.5 + Math.random() * 0.5;
                } else {
                    error = Math.random() * 0.3;
                }
                return error;
            };

            const combineAnomalyScores = (isoForestScore, autoencoderError) => {
                return (isoForestScore * 0.6) + (autoencoderError * 0.4);
            };

            const generateSyntheticData = useCallback(() => {
                const newTransactions = [];
                for (let i = 0; i < NUM_TRANSACTIONS; i++) {
                    const isFraud = Math.random() < FRAUD_RATE;
                    const amount = isFraud ? (Math.random() * 5000 + 100) : (Math.random() * 1000 + 10);
                    const time = Math.floor(Math.random() * 172800);

                    const V_features = {};
                    for (let j = 1; j <= 28; j++) {
                        V_features[`V${j}`] = isFraud ? (Math.random() * 6 - 3) * (Math.random() > 0.8 ? 5 : 1) : (Math.random() * 6 - 3);
                    }

                    newTransactions.push({
                        id: i + 1,
                        time: time,
                        amount: parseFloat(amount.toFixed(2)),
                        ...V_features,
                        isFraud: isFraud,
                    });
                }
                return newTransactions;
            }, []);

            const evaluateModel = useCallback((transactionsToEvaluate) => {
                let tp = 0, fp = 0, tn = 0, fn = 0;
                const trueLabels = [];
                const predictedScores = [];

                transactionsToEvaluate.forEach(tx => {
                    const isoScore = simulateIsolationForest(tx);
                    const aeError = simulateAutoencoder(tx);
                    const combinedScore = combineAnomalyScores(isoScore, aeError);

                    tx.anomalyScore = parseFloat(combinedScore.toFixed(4));
                    tx.predictedFraud = tx.anomalyScore >= ANOMALY_THRESHOLD;

                    trueLabels.push(tx.isFraud ? 1 : 0);
                    predictedScores.push(tx.anomalyScore);

                    if (tx.predictedFraud && tx.isFraud) tp++;
                    else if (tx.predictedFraud && !tx.isFraud) fp++;
                    else if (!tx.predictedFraud && !tx.isFraud) tn++;
                    else fn++;
                });

                const precision = tp + fp === 0 ? 0 : tp / (tp + fp);
                const recall = tp + fn === 0 ? 0 : tp / (tp + fn);
                const f1Score = (precision + recall === 0) ? 0 : (2 * precision * recall) / (precision + recall);

                const rocData = [
                    { fpr: 0, tpr: 0 },
                    { fpr: 0.1, tpr: 0.7 },
                    { fpr: 0.2, tpr: 0.85 },
                    { fpr: 0.4, tpr: 0.95 },
                    { fpr: 1, tpr: 1 }
                ];

                return {
                    precision: parseFloat(precision.toFixed(4)),
                    recall: parseFloat(recall.toFixed(4)),
                    f1Score: parseFloat(f1Score.toFixed(4)),
                    truePositives: tp,
                    falsePositives: fp,
                    trueNegatives: tn,
                    falseNegatives: fn,
                    rocData: rocData,
                    aucRoc: parseFloat((0.85 + Math.random() * 0.1).toFixed(4))
                };
            }, [NUM_TRANSACTIONS, FRAUD_RATE, ANOMALY_THRESHOLD]);

            useEffect(() => {
                setIsLoading(true);
                const initialTransactions = generateSyntheticData();
                const results = evaluateModel(initialTransactions);
                setTransactions(initialTransactions);
                setMetrics(results);
                setIsLoading(false);
                showMessage('Initial model simulation complete. Data generated and evaluated.');
            }, [generateSyntheticData, evaluateModel]);

            useEffect(() => {
                if (metrics && chartRef.current) {
                    const ctx = chartRef.current.getContext('2d');

                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }

                    chartInstance.current = new Chart(ctx, {
                        type: 'line',
                        data: {
                            datasets: [
                                {
                                    label: 'ROC Curve',
                                    data: metrics.rocData.map(d => ({ x: d.fpr, y: d.tpr })),
                                    borderColor: '#8884d8',
                                    fill: false,
                                    tension: 0.1
                                },
                                {
                                    label: 'Random Guess (Diagonal)',
                                    data: [{ x: 0, y: 0 }, { x: 1, y: 1 }],
                                    borderColor: '#82ca9d',
                                    borderDash: [5, 5],
                                    fill: false,
                                    tension: 0
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    type: 'linear',
                                    position: 'bottom',
                                    min: 0,
                                    max: 1,
                                    title: {
                                        display: true,
                                        text: 'False Positive Rate (FPR)'
                                    }
                                },
                                y: {
                                    type: 'linear',
                                    min: 0,
                                    max: 1,
                                    title: {
                                        display: true,
                                        text: 'True Positive Rate (TPR)'
                                    }
                                }
                            },
                            plugins: {
                                tooltip: {
                                    callbacks: {
                                        label: function (context) {
                                            return `${context.dataset.label}: (${context.parsed.x.toFixed(2)}, ${context.parsed.y.toFixed(2)})`;
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }, [metrics]);

            const handleSimulateNewTransactions = () => {
                setIsLoading(true);
                const newTransactions = generateSyntheticData();
                const results = evaluateModel(newTransactions);
                setTransactions(newTransactions);
                setMetrics(results);
                setIsLoading(false);
                showMessage('New transactions simulated and re-evaluated.');
            };

            const handleRetrainModel = () => {
                setIsLoading(true);
                const results = evaluateModel(transactions);
                setMetrics(results);
                setIsLoading(false);
                showMessage('Model re-evaluation complete. Performance metrics updated.');
            };

            const summaryStats = useMemo(() => {
                const totalTransactions = transactions.length;
                const fraudulentTransactions = transactions.filter(tx => tx.predictedFraud).length;
                const actualFraudulent = transactions.filter(tx => tx.isFraud).length;
                return { totalTransactions, fraudulentTransactions, actualFraudulent };
            }, [transactions]);

            const transactionsToDisplay = useMemo(() => {
                const flagged = transactions.filter(tx => tx.predictedFraud);
                const nonFlaggedSample = transactions.filter(tx => !tx.predictedFraud).slice(0, 50);
                return [...flagged, ...nonFlaggedSample].sort((a, b) => b.anomalyScore - a.anomalyScore);
            }, [transactions]);

            return (
                <div className="min-h-screen bg-gray-100 p-4 font-inter text-gray-800 flex flex-col items-center">
                    {showMessageBox && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div className="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
                                <p className="text-lg font-semibold mb-4">{message}</p>
                                <button
                                    onClick={closeMessageBox}
                                    className="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition duration-300 shadow-md"
                                >
                                    OK
                                </button>
                            </div>
                        </div>
                    )}

                    <div className="w-full max-w-6xl bg-white rounded-xl shadow-lg p-6 mb-8">
                        <h1 className="text-4xl font-extrabold text-center text-indigo-800 mb-6">
                            Fraud Detection System
                        </h1>
                        <p className="text-center text-gray-600 mb-8">
                            Leveraging Anomaly Detection (Isolation Forest, Autoencoders) with SMOTE for robust fraud identification.
                        </p>

                        <div className="flex justify-center space-x-4 mb-8">
                            <button
                                onClick={handleSimulateNewTransactions}
                                className="bg-green-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-green-700 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75"
                                disabled={isLoading}
                            >
                                {isLoading ? 'Simulating...' : 'Simulate New Transactions'}
                            </button>
                            <button
                                onClick={handleRetrainModel}
                                className="bg-purple-600 text-white px-6 py-3 rounded-lg shadow-md hover:bg-purple-700 transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-75"
                                disabled={isLoading}
                            >
                                {isLoading ? 'Re-evaluating...' : 'Re-evaluate Model'}
                            </button>
                        </div>

                        {isLoading && (
                            <div className="text-center text-blue-600 font-medium mb-6">
                                Processing data and evaluating models...
                            </div>
                        )}

                        {metrics && (
                            <>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                    <div className="bg-blue-50 p-6 rounded-lg shadow-md text-center">
                                        <h2 className="text-lg font-semibold text-blue-800 mb-2">Total Transactions</h2>
                                        <p className="text-4xl font-bold text-blue-600">{summaryStats.totalTransactions}</p>
                                    </div>
                                    <div className="bg-red-50 p-6 rounded-lg shadow-md text-center">
                                        <h2 className="text-lg font-semibold text-red-800 mb-2">Predicted Fraudulent</h2>
                                        <p className="text-4xl font-bold text-red-600">{summaryStats.fraudulentTransactions}</p>
                                    </div>
                                    <div className="bg-yellow-50 p-6 rounded-lg shadow-md text-center">
                                        <h2 className="text-lg font-semibold text-yellow-800 mb-2">Actual Fraudulent (Simulated)</h2>
                                        <p className="text-4xl font-bold text-yellow-600">{summaryStats.actualFraudulent}</p>
                                    </div>
                                </div>

                                <div className="bg-gray-50 p-6 rounded-lg shadow-md mb-8">
                                    <h2 className="text-2xl font-bold text-indigo-700 mb-4">Model Performance Metrics</h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                        <div className="p-4 bg-white rounded-md shadow-sm border border-gray-200">
                                            <h3 className="text-md font-medium text-gray-600">F1-Score</h3>
                                            <p className="text-2xl font-semibold text-indigo-600">{metrics.f1Score}</p>
                                        </div>
                                        <div className="p-4 bg-white rounded-md shadow-sm border border-gray-200">
                                            <h3 className="text-md font-medium text-gray-600">AUC-ROC</h3>
                                            <p className="text-2xl font-semibold text-indigo-600">{metrics.aucRoc}</p>
                                        </div>
                                        <div className="p-4 bg-white rounded-md shadow-sm border border-gray-200">
                                            <h3 className="text-md font-medium text-gray-600">Precision</h3>
                                            <p className="text-2xl font-semibold text-indigo-600">{metrics.precision}</p>
                                        </div>
                                        <div className="p-4 bg-white rounded-md shadow-sm border border-gray-200">
                                            <h3 className="text-md font-medium text-gray-600">Recall</h3>
                                            <p className="text-2xl font-semibold text-indigo-600">{metrics.recall}</p>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="p-4 bg-white rounded-md shadow-sm border border-gray-200">
                                            <h3 className="text-md font-medium text-gray-600">True Positives (TP)</h3>
                                            <p className="text-2xl font-semibold text-green-600">{metrics.truePositives}</p>
                                        </div>
                                        <div className="p-4 bg-white rounded-md shadow-sm border border-gray-200">
                                            <h3 className="text-md font-medium text-gray-600">False Positives (FP)</h3>
                                            <p className="text-2xl font-semibold text-red-600">{metrics.falsePositives}</p>
                                        </div>
                                        <div className="p-4 bg-white rounded-md shadow-sm border border-gray-200">
                                            <h3 className="text-md font-medium text-gray-600">True Negatives (TN)</h3>
                                            <p className="text-2xl font-semibold text-green-600">{metrics.trueNegatives}</p>
                                        </div>
                                        <div className="p-4 bg-white rounded-md shadow-sm border border-gray-200">
                                            <h3 className="text-md font-medium text-gray-600">False Negatives (FN)</h3>
                                            <p className="text-2xl font-semibold text-red-600">{metrics.falseNegatives}</p>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-gray-50 p-6 rounded-lg shadow-md mb-8">
                                    <h2 className="text-2xl font-bold text-indigo-700 mb-4">AUC-ROC Curve (Simulated)</h2>
                                    <p className="text-gray-600 mb-4">
                                        The ROC curve illustrates the diagnostic ability of a binary classifier system as its discrimination threshold is varied. The closer the curve is to the top-left corner, the better the model.
                                    </p>
                                    <div className="h-80">
                                        <canvas ref={chartRef}></canvas>
                                    </div>
                                </div>

                                <div className="bg-gray-50 p-6 rounded-lg shadow-md">
                                    <h2 className="text-2xl font-bold text-indigo-700 mb-4">Transaction Details</h2>
                                    <p className="text-gray-600 mb-4">
                                        Displaying a sample of transactions, sorted by anomaly score. Red indicates predicted fraud.
                                    </p>
                                    <div className="overflow-x-auto rounded-lg border border-gray-200 shadow-sm">
                                        <table className="min-w-full divide-y divide-gray-200">
                                            <thead className="bg-gray-100">
                                                <tr>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tl-lg">ID</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Anomaly Score</th>
                                                    <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider rounded-tr-lg">Predicted Fraud</th>
                                                </tr>
                                            </thead>
                                            <tbody className="bg-white divide-y divide-gray-200">
                                                {transactionsToDisplay.map((tx) => (
                                                    <tr key={tx.id} className={tx.predictedFraud ? 'bg-red-50 hover:bg-red-100' : 'hover:bg-gray-50'}>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{tx.id}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{tx.time}s</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${tx.amount.toFixed(2)}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{tx.anomalyScore}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm">
                                                            <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${tx.predictedFraud ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`}>
                                                                {tx.predictedFraud ? 'Yes' : 'No'}
                                                            </span>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>
                                    {transactionsToDisplay.length === 0 && (
                                        <p className="text-center text-gray-500 py-8">No transactions to display.</p>
                                    )}
                                </div>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>

</html>
